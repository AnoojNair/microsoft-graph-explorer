<!-- Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.  See License in the project root for license information. -->

<div ng-app="ApiExplorer" ng-controller="ApiExplorerCtrl" role="document" id="api-explorer-app">
    <form ng-controller="FormCtrl" ng-cloak>
    <div class="ms-Grid"> 
        <div class="ms-Grid-row">
            <div class="ms-Grid-col ms-u-sm12 ms-u-md12 ms-u-lg4 ms-u-xl3 ms-u-xxl2" id="explorer-sidebar">
                <div class="c-drawer">
                    <button id="auth-drawer-button" class="c-glyph" aria-expanded="true" disabled="true" aria-controls="authDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--Permissions" title="FavoriteList" aria-hidden="true"></i>Authentication</span></button>
                    <div id="authDrawer" class="panel-content">
                        <div ng-hide="isAuthenticated()">
                            <div tabindex=0>{{::str['Using demo tenant']}}</div>
                            <div tabindex=0>{{::str['To access your own data:']}}</div>
                            <img id="ms-signin-button" alt="{{::str['sign in']}}" src="{{::getAssetPath('assets/images/MSSignInButton.svg')}}" ng-click="login()"/>
                        </div>
                        <div ng-show="isAuthenticated()" ng-cloak>
                            <span id='userEmail' ng-if="userInfo.preferred_username" tabindex=0>{{userInfo.preferred_username}}</span>
                            <md-button id="signout" class="" tabindex=0 ng-click="logout()">{{::str['sign out']}}</md-button>
                        </div>
                    </div>
                </div>

                <div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="refineDrawer">
                        
                        <span class="c-heading-5 panel-header"><img  id="getting-started-svg" src="{{::getAssetPath('assets/images/rocket1.svg')}}"/>Getting Started</span></button>
                    <div id="refineDrawer" class="panel-content">
                        <div getting-started>
                            <div ng-repeat="query in queries" class="api-query" ng-click="runQuery(query)">
                                <span class="request-badge" ng-class="query.method">{{query.method}}</span><span>{{query.humanName}}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="refineDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--FavoriteList" title="FavoriteList" aria-hidden="true"></i>My Queries</span></button>
                    <div id="refineDrawer">
                    </div>
                </div>

                <div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="refineDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--History" title="FavoriteList" aria-hidden="true"></i>History</span></button>
                    <div id="refineDrawer">
                    </div>
                </div>

            </div>
            <div class="ms-Grid-col ms-u-sm12 ms-u-md12  ms-u-lg8 ms-u-xl9 ms-u-xxl10" id="explorer-main">
        
        <div ng-controller="datalistCtrl" role="form">
            <div layout="row" layout-align="start center">
                <!-- History button -->
                <!--<md-menu md-offset="0 45" ng-cloak>
                    <div>
                        <md-button class="md-icon-button" id="historyButton" ng-click="$mdOpenMenu($event)" ng-disabled="getRequestHistory().length==0" aria-label="history">
                            <md-icon class="historyIcon" md-svg-icon="{{::getAssetPath('assets/images/rocket.svg')}}"></md-icon>
                        </md-button>
                        <md-tooltip aria-label="history" md-direction="top" ng-cloak>
                            {{::str['History']}}
                        </md-tooltip>
                    </div>
                    <md-menu-content width="6">
                        <table id="historyTable">
                            <tr>
                                <th>{{::str['Method']}}</th>
                                <th>{{::str['Query']}}</th>
                                <th>{{::str['Status Code']}}</th>
                                <th>{{::str['Duration']}}</th>
                            </tr>
                            <tr class="historyRow" ng-repeat="call in getRequestHistory() track by call.requestId" ng-click="historyOnClick(call)">
                                <td>
                                    {{::call.htmlOption}}
                                </td>
                                <td class="historyUrl">
                                    {{::call.urlText}}
                                </td>
                                <td ng-class="::{success: call.successful, error: !call.successful}">
                                    {{::call.statusCode}}
                                </td>
                                <td>
                                    {{::call.duration}} ms
                                </td>
                            </tr>
                        </table>
                    </md-menu-content>
                </md-menu>-->


                <!-- HTTP METHOD -->
                <div class="c-select f-border" http-method-select>
                    <select ng-model="apiService.selectedOption" ng-disabled="!isAuthenticated()">
                        <option ng-repeat="choice in methods">{{choice}}</option>
                    </select>
                </div>

                <!-- version button -->
                <div class="c-select f-border" version-select id="version-select">
                    <select ng-model="apiService.selectedVersion">
                        <option ng-repeat="choice in items">{{choice}}</option>
                    </select>
                </div>

                <!-- autocomplete -->
                <md-autocomplete flex
                    md-no-cache="true"
                    md-search-text="searchText"
                    md-search-text-change="searchTextChange(searchText)"
                    md-selected-item-change="searchTextChangeFromAutoCompleteItem(graphAutoCompleteItem)"
                    md-items="graphAutoCompleteItem in getMatches(searchText)"
                    md-item-text="graphAutoCompleteItem.fullUrl"
                    md-min-length="0">
                    <span id="autocompleteText">{{graphAutoCompleteItem.url}}</span>
                </md-autocomplete>


                <!--Submit button-->                    
                <!--</button>-->
                <button name="button" class="c-button explorer-form-row" type="submit" ng-click="submit(searchText)">
                    <span ng-hide="requestInProgress"><i class="ms-Icon ms-Icon--LightningBolt"  style="padding-right: 10px;" title="LightningBolt" aria-hidden="true"></i>Run Query</span>
                    <md-progress-circular md-diameter="20px" aria-label="response loading" md-mode="indeterminate" ng-show="requestInProgress" ng-cloak></md-progress-circular>
                </button>
                <!-- share button-->
                <!--<md-button class="md-icon-button" aria-label="Share" ng-click="showShareDialog($event)">
                    <md-icon md-svg-icon="{{::getAssetPath('assets/images/share-square-o.svg')}}"></md-icon>
                    <md-tooltip aria-label="history" md-direction="top" ng-cloak>
                        {{::str['Share Query']}}
                    </md-tooltip>
                </md-button>-->
            </div>
        </div>
        <div id="responseMessage" response-message api-response="lastApiResponse" ng-show="lastApiResponse != null"></div>
        <!-- admin consent bar -->
        <div id="adminConsent" layout="row" layout-align="start center" ng-show="insufficientPrivileges" ng-cloak>
            <span id="needAdminConsent">
                This query requires additional permissions. If you are an administrator, you can click
                <a href="" ng-click="getAdminConsent()"> here </a>
                to grant them on behalf of your entire organization.
                Or, you can try the same request against your own tenant by creating a free <a href="http://dev.office.com/devprogram" target="_blank">Office 365 developer account.</a>
            </span>
            <div class="flexbox-parent">
                <div class="closeColumn" layout="row" layout-align="end start" style="min-height:50px">
                    <md-button ng-click="closeAdminConsentBar()"> x </md-button>
                </div>
            </div>
        </div>

        <!-- request -->
        <md-tabs md-dynamic-height md-selected="tabConfig.selected" ng-cloak ng-class="{'hideTabContent':tabConfig.hideContent}">
            <md-tab label="{{::str['request header']}}" md-on-select="onTabSelected(0)" ng-click="processTabClick(tabConfig.selected)">
                <md-tab-body>
                    <div id="jsonEditorHeaders"></div>
                </md-tab-body>
            </md-tab>
            <md-tab label="{{::str['request body']}}" md-on-select="onTabSelected(1)" ng-click="processTabClick(tabConfig.selected)" ng-disabled="tabConfig.disableRequestBodyEditor">
                <md-tab-body>
                    <div id="requestBodyContainer">
                        <div id="jsonEditor"></div>
                    </div>
                </md-tab-body>
            </md-tab>
        </md-tabs>

        <!-- response -->
        <md-tabs md-dynamic-height ng-cloak>
            <md-tab label="{{::str['response']}}">
                <md-tab-body>
                    <img id="img" width="250px" height="250px" ng-show="showImage" style="margin-top:10px" ng-cloak />
                    <div id="jsonViewer"></div>

                    <!--<svg id="visual-explorer" width="1200" height="1000"/></svg>-->
                    
                </md-tab-body>
            </md-tab>
        </md-tabs>
    </form>
            </div>
        </div>
    </div>
    
</div>