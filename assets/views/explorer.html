<!-- Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.  See License in the project root for license information. -->

<div ng-app="ApiExplorer" ng-controller="ApiExplorerCtrl" role="document" id="api-explorer-app">
    <form>
    <div class="ms-Grid"> 
        <div class="ms-Grid-row">
            <div class="ms-Grid-col ms-u-sm12 ms-u-md12 ms-u-lg4 ms-u-xl3 ms-u-xxl3 ms-u-xxxl2" id="explorer-sidebar">
                <div class="arrow-left"></div>
                <div>
                    <span id="explorer-title" class="c-heading-3 panel-header">{{::getStr(['Graph Explorer'])}}</span>
                </div>
                <div class="c-drawer">
                    <button id="auth-drawer-button" class="c-glyph" aria-expanded="true" disabled="true" aria-controls="authDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--Permissions" title="FavoriteList" aria-hidden="true"></i>{{::getStr(['Authentication'])}}</span></button>
                    <div id="authDrawer" class="panel-content">
                        <div ng-show="authenticationStatus == 'anonymous'">
                            <div tabindex="-1">{{::getStr(['Using demo tenant'])}}</div>
                            <div tabindex="-1">{{::getStr(['To access your own data:'])}}</div>
                            <img id="ms-signin-button" alt="{{::getStr(['sign in'])}}" src="{{::getAssetPath('assets/images/MSSignInButton.svg')}}" ng-click="login()"/>
                        </div>
                        <div ng-show="authenticationStatus == 'authenticating'">
                            <div class="c-progress f-indeterminate-local f-progress-small" id="authenticating-progress-bar" role="progressbar" aria-valuetext="Loading..." tabindex="0" aria-label="indeterminate local small progress bar">
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                        <div ng-show="authenticationStatus == 'authenticated'" ng-cloak>
                            <div class="ms-Persona" ng-class="{'user-no-image': !userInfo.profileImageUrl}">
                                <div class="ms-Persona-imageArea" ng-if="userInfo.profileImageUrl">
                                    <img class="ms-Persona-image" ng-src="{{userInfo.profileImageUrl}}">
                                </div>
                                <div class="ms-Persona-details">
                                    <div class="ms-Persona-primaryText" id='userDisplayName' ng-if="userInfo.displayName">{{userInfo.displayName}}</div>
                                    <div class="ms-Persona-secondaryText" id='userMail' ng-if="userInfo.mail">{{userInfo.mail}}</div>
                                </div>
                            </div>
                            <a href="#" id="signout" class="c-hyperlink" tabindex=0 ng-click="logout()">{{::getStr(['sign out'])}}</a>
                            
                            <!--<a href="#" role="button" id="signout" class="c-button f-lightweight" tabindex=0 ng-click="logout()">{{::getStr(['sign out'])}}</a>-->
                        </div>
                    </div>
                </div>

                <div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="refineDrawer">
                        
                        <span class="c-heading-5 panel-header"><img  id="getting-started-svg" src="{{::getAssetPath('assets/images/rocket1.svg')}}"/>{{::getStr(['Getting Started'])}}</span></button>
                    <div id="refineDrawer" class="panel-content">
                        <div getting-started>
                            <query-row query="query" ng-repeat="query in queries"></query-row>
                        </div>
                    </div>
                </div>

                <!--<div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="refineDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--FavoriteList" title="FavoriteList" aria-hidden="true"></i>My Queries</span></button>
                    <div id="refineDrawer">
                    </div>
                </div>-->

                <div class="c-drawer">
                    <button class="c-glyph" aria-expanded="true" aria-controls="historyDrawer">
                         <span class="c-heading-5 panel-header"><i class="ms-Icon ms-Icon--History" aria-hidden="true"></i>{{::getStr(['History'])}}</span></button>
                    <div id="historyDrawer" class="panel-content">
                        <query-row query="query" ng-repeat="query in getRequestHistory(5) track by query.requestId">
                            <div class="history-row-2">
                                <span class="date">{{::query.requestSentAt}} ms</span>
                                <span class="status-code"  ng-class="{'success': query.successful, 'error': !query.successful}">{{::query.statusCode}}</span>
                                <span class="duration">{{::query.duration}} ms</span>
                            </div>
                        </query-row>
                    </div>
                </div>

            </div>
            <div class="ms-Grid-col ms-u-sm12 ms-u-md12  ms-u-lg8 ms-u-xl9 ms-u-xxl9 ms-u-xxxl10" id="explorer-main">
        
        <div>
            <div id="request-bar-row-form" layout="row" layout-align="start center">
                <!-- HTTP METHOD -->
                <div title="{{isAuthenticated() ? null : getStr(['login to send requests'])}}" class="c-select f-border first-row-mobile bump-flex-row-mobile" http-method-select>
                    <select ng-model="apiService.selectedOption" ng-disabled="!isAuthenticated()">
                        <option ng-repeat="choice in methods">{{choice}}</option>
                    </select>
                </div>

                <!-- version button -->
                <div class="c-select f-border first-row-mobile bump-flex-row-mobile" version-select id="version-select">
                    <select ng-model="apiService.selectedVersion">
                        <option ng-repeat="choice in items">{{choice}}</option>
                    </select>
                </div>

                <!-- autocomplete -->
                <md-autocomplete flex
                    md-no-cache="true"
                    md-search-text="searchText"
                    md-search-text-change="searchTextChange(searchText)"
                    md-selected-item-change="searchTextChangeFromAutoCompleteItem(graphAutoCompleteItem)"
                    md-items="graphAutoCompleteItem in getMatches(searchText)"
                    md-item-text="graphAutoCompleteItem.fullUrl"
                    md-min-length="0" autocomplete-submit>
                    <span id="autocompleteText">{{graphAutoCompleteItem.url}}</span>
                </md-autocomplete>


                <!--Submit button-->                    
                <!--</button>-->
                <button name="button" class="c-button explorer-form-row bump-flex-row-mobile" type="submit" ng-click="submit(searchText)">
                    <span ng-hide="requestInProgress"><i class="ms-Icon ms-Icon--LightningBolt"  style="padding-right: 10px;" title="LightningBolt" aria-hidden="true"></i>{{::getStr(['Run Query'])}}</span>
                    <md-progress-circular md-diameter="20px" aria-label="response loading" md-mode="indeterminate" ng-show="requestInProgress" ng-cloak></md-progress-circular>
                </button>
            
                <!-- share button-->
                <!--<md-button class="md-icon-button" aria-label="Share" ng-click="showShareDialog($event)">
                    <md-icon md-svg-icon="{{::getAssetPath('assets/images/share-square-o.svg')}}"></md-icon>
                    <md-tooltip aria-label="history" md-direction="top" ng-cloak>
                        {{::getStr(['Share Query'])}}
                    </md-tooltip>
                </md-button>-->
            </div>
        </div>
        <div id="responseMessage" response-message api-response="lastApiResponse" ng-show="lastApiResponse != null"></div>
        <!-- admin consent bar -->
        <div id="adminConsent" layout="row" layout-align="start center" ng-show="insufficientPrivileges" ng-cloak>
            <span id="needAdminConsent">
                This query requires additional permissions. If you are an administrator, you can click
                <a href="" ng-click="getAdminConsent()"> here </a>
                to grant them on behalf of your entire organization.
                Or, you can try the same request against your own tenant by creating a free <a href="http://dev.office.com/devprogram" target="_blank">Office 365 developer account.</a>
            </span>
            <div class="flexbox-parent">
                <div class="closeColumn" layout="row" layout-align="end start" style="min-height:50px">
                    <md-button ng-click="closeAdminConsentBar()"> x </md-button>
                </div>
            </div>
        </div>

        <!-- request -->
        <div class="ms-Pivot ">
            <ul class="ms-Pivot-links">
                <li class="ms-Pivot-link is-selected" ng-click="onTabSelected(0)" data-content="headers" title="{{::getStr(['request header'])}}" tabindex="1">
                    {{::getStr(['request header'])}}
                </li>
                <li class="ms-Pivot-link" ng-click="onTabSelected(1)" data-content="body" title="{{::getStr(['request body'])}}" tabindex="1">
                    {{::getStr(['request body'])}}
                </li>
            </ul>
            <div class="ms-Pivot-content" data-content="headers">
                <div id="jsonEditorHeaders"></div>
            </div>
            <div class="ms-Pivot-content" data-content="body">
                <div id="requestBodyContainer">
                    <div id="jsonEditor"></div>
                </div>
            </div>
        </div>

        <!-- response -->
        <div class="ms-Pivot" id="response-viewer-labels" tabindex="-1">
            <ul class="ms-Pivot-links">
                <li class="ms-Pivot-link is-selected" data-content="response" title="{{getStr(['Response'])}}" tabindex="1">
                    {{getStr(['Response'])}}
                </li>
            </ul>
            <div class="ms-Pivot-content" data-content="response">
                <div>
                    <img id="img" width="250px" height="250px" ng-show="showImage" style="margin-top:10px" ng-cloak />
                    <div id="jsonViewer"></div>

                    <!--<svg id="visual-explorer" width="1200" height="1000"/></svg>-->
                </div>
            </div>
        </div>
    </form>
</div>