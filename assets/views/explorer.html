<!-- Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.  See License in the project root for license information. -->

<div ng-app="ApiExplorer" ng-controller="ApiExplorerCtrl" role="document">
    <form ng-controller="FormCtrl" ng-cloak>
        <div ng-hide="isAuthenticated()" layout="row" layout-align="end center">
            <span tabindex=0>{{::str['Using demo tenant']}}</span>
            <md-button id="signin" tabindex=0 ng-click="login()">{{::str['sign in']}}</md-button>
        </div>
        <div ng-show="isAuthenticated()" layout="row" layout-align="end center" ng-cloak>
            <span id='userEmail' ng-if="userInfo.preferred_username" tabindex=0>{{userInfo.preferred_username}}</span>
            <md-button id="signout" tabindex=0 ng-click="logout()">{{::str['sign out']}}</md-button>
        </div>
        <div ng-controller="datalistCtrl" role="form">
            <div layout="row" layout-align="start center">
                <!-- History button -->
                <md-menu md-offset="0 45" ng-cloak>
                    <div>
                        <md-button class="md-icon-button" id="historyButton" ng-click="$mdOpenMenu($event)" ng-disabled="history.length==0" aria-label="history">
                            <i class="fa fa-history historyIcon" aria-hidden="true"></i>
                        </md-button>
                        <md-tooltip aria-label="history" md-direction="top" ng-cloak>
                            {{::str['History']}}
                        </md-tooltip>
                    </div>
                    <md-menu-content width="6">
                        <table id="historyTable">
                            <tr>
                                <th>{{::str['Method']}}</th>
                                <th>{{::str['Query']}}</th>
                                <th>{{::str['Status Code']}}</th>
                                <th>{{::str['Duration']}}</th>
                            </tr>
                            <tr class="historyRow" ng-repeat="call in history" ng-click="historyOnClick(call)">
                                <td>
                                    {{::call.htmlOption}}
                                </td>
                                <td class="historyUrl">
                                    {{::call.urlText}}
                                </td>
                                <td ng-class="::{success: call.successful, error: !call.successful}">
                                    {{::call.statusCode}}
                                </td>
                                <td>
                                    {{::call.duration}} ms
                                </td>
                            </tr>
                        </table>
                    </md-menu-content>
                </md-menu>

                <!-- version button -->
                <md-menu md-offset="0 45" ng-controller="VersionCtrl" ng-cloak>
                    <md-button class="md-raised" ng-click="$mdOpenMenu($event)" layout-align="space-around center">
                        {{getServiceVersion()}}
                        <span> &#9660; </span>
                    </md-button>
                    <md-menu-content>
                        <md-menu-item ng-repeat="choice in items">
                            <md-button ng-click="onItemClick(choice)">
                                {{choice}}
                            </md-button>
                        </md-menu-item>
                    </md-menu-content>
                </md-menu>

                <md-menu md-offset="0 45" ng-controller="DropdownCtrl" ng-cloak>
                    <div>
                        <md-button class="md-raised" ng-disabled="!isAuthenticated()" ng-click="$mdOpenMenu($event)" layout-align="space-around center">
                            {{getServiceOption()}}
                            <span> &#9660;</span>
                        </md-button>
                        <md-tooltip aria-label="history" md-direction="top" ng-if="!isAuthenticated()"  ng-cloak>
                            {{str.login_to_send_requests}}
                        </md-tooltip>
                    </div>
                    <md-menu-content>
                        <md-menu-item ng-repeat="choice in items">
                            <md-button ng-click="onItemClick(choice)">
                                {{ choice }}
                            </md-button>
                        </md-menu-item>
                    </md-menu-content>
                </md-menu>

                <!-- autocomplete -->
                
                <md-autocomplete flex
                                role="combobox"
                                title="{{searchText}}"
                                md-selected-item="text"
                                md-no-cache="true"
                                md-search-text="searchText"
                                md-search-text-change="searchTextChange(searchText)"
                                md-items="item in getMatches(searchText)"
                                md-item-text="item.autocompleteVal"
                                md-min-length="0"
                                md-selected-item-change="processAutocompleteClick(item)" on-enter ng-cloak>
                    <span id="autocompleteText" md-highlight-text="searchText" md-highlight-flags="^i" title="{{item.autocompleteVal}}">{{item.autocompleteVal}}</span>
                </md-autocomplete>

                <md-button class="md-raised" type="submit" ng-click="submit(searchText)" ng-cloak>
                    <div layout="row" layout-align="center center">
                        <span ng-hide="requestInProgress">
                            {{str.Go}}
                        </span>
                        <md-progress-circular md-diameter="20px" aria-label="response loading" md-mode="indeterminate" ng-show="requestInProgress" ng-cloak></md-progress-circular>
                    </div>
                </md-button>
                <md-button class="md-icon-button" aria-label="Share">
                    <md-icon md-svg-icon="{{::getAssetPath('assets/images/share-arrow.svg')}}"></md-icon>
                </md-button>
            </div>
        </div>

        <!-- admin consent bar -->
        <div id="adminConsent" layout="row" layout-align="start center" ng-show="insufficientPrivileges" ng-cloak>
            <span id="needAdminConsent">
                This query requires additional permissions. If you are an administrator, you can click
                <a href="" ng-click="getAdminConsent()"> here </a>
                to grant them on behalf of your entire organization.
                Or, you can try the same request against your own tenant by creating a free <a href="http://dev.office.com/devprogram" target="_blank">Office 365 developer account.</a>
            </span>
            <div class="flexbox-parent">
                <div class="closeColumn" layout="row" layout-align="end start" style="min-height:50px">
                    <md-button ng-click="closeAdminConsentBar()"> x </md-button>
                </div>
            </div>
        </div>

        <!-- request -->
        <md-tabs md-dynamic-height md-selected="tabConfig.selected" ng-cloak ng-class="{'hideTabContent':tabConfig.hideContent}">
            <md-tab label="{{::str['request header']}}" md-on-select="onTabSelected(0)" ng-click="processTabClick(tabConfig.selected)">
                <md-tab-body>
                    <div id="jsonEditorHeaders"></div>
                </md-tab-body>
            </md-tab>
            <md-tab label="{{::str['request body']}}" md-on-select="onTabSelected(1)" ng-click="processTabClick(tabConfig.selected)" ng-disabled="tabConfig.disableRequestBodyEditor">
                <md-tab-body>
                    <div id="requestBodyContainer">
                        <div id="jsonEditor"></div>
                        <md-button id="insertTemplateButton" ng-if="canInsertTemplate()" class="md-raised md-mini" ng-click="insertPostTemplate()">Insert {{getCurrentEntityName()}} template</md-button>
                    </div>
                </md-tab-body>
            </md-tab>
        </md-tabs>

        <img id="img" width="250px" height="250px" ng-show="showImage" ng-cloak />

        <!-- response -->
        <md-tabs md-dynamic-height ng-cloak>
            <md-tab label="{{::str['response']}}">
                <md-tab-body>
                    <div id="jsonViewer"></div>
                </md-tab-body>
            </md-tab>
        </md-tabs>
    </form>
</div>